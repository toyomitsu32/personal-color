# AI パーソナルカラー診断ツール (AI Personal Color Analyzer)

ブラウザ上で動作する、AIを用いた顔パーツの色分析とパーソナルカラー診断ツールです。
Google MediaPipe Face Landmarkerを使用し、アップロードされた画像から人物の顔を検出し、髪、目、鼻（肌）、口の色を自動的に抽出。さらに、これらの色情報から**春夏秋冬のパーソナルカラータイプ**を診断します。

## 主な機能

### 1. **AI顔検出・色抽出**
画像内の顔を高精度に検出し、目、鼻、口、髪の位置をランドマークとして特定。各パーツの領域から主要な色（RGB/HEX）を自動抽出して表示します。

### 2. **パーソナルカラー診断**
抽出した色情報から、イエベ/ブルベ、明度、彩度、コントラストを分析し、**スプリング・サマー・オータム・ウィンター**の4つのシーズンタイプを判定します。

### 3. **カラーパレット提案**
診断結果に基づいて、似合う色と避けたい色を具体的に提案。あなたに最適なファッションやメイクの色選びをサポートします。

### 4. **AI画像生成ヘアカラーシミュレーション** ✨NEW
診断されたパーソナルカラーに基づいて、**最先端の画像生成AI**があなたに似合う3パターンのヘアカラーを自動生成。従来のピクセル編集ではなく、AIが画像全体を理解して自然で高品質なヘアカラー変更を実現。Before/After比較で、理想のヘアカラーを見つけられます。

### 5. **日本語対応PDFエクスポート** ✨NEW
診断結果とヘアカラーシミュレーションのBefore/After画像をまとめたPDFレポートを生成。完全日本語対応で文字化けなし。美容院やショッピングに持参して、カラーコーディネートの参考にできます。

### 6. **プライバシー保護**
画像処理はすべてブラウザ内（クライアントサイド）で行われるため、画像データが外部サーバーに送信されることはありません。

## パーソナルカラー診断とは？

パーソナルカラー診断は、肌・髪・瞳の色から、その人に最も似合う色を判定する理論です。大きく4つのシーズンタイプに分類されます：

- **スプリング（イエベ春）**: 明るく華やかな暖色系が似合う
- **サマー（ブルベ夏）**: 柔らかく上品な寒色系が似合う  
- **オータム（イエベ秋）**: 深みのある落ち着いた暖色系が似合う
- **ウィンター（ブルベ冬）**: はっきりとした鮮やかな寒色系が似合う

本ツールは、これらの診断を**AI技術で自動化**し、客観的な色データに基づいた診断結果を提供します。

## 技術スタック

*   **Frontend**: HTML5, CSS3, JavaScript (ES6+ Modules)
*   **AI/ML**: Google MediaPipe Face Landmarker (WebAssembly/WebGL)
*   **Styling**: Tailwind CSS (CDN), Material Icons
*   **Canvas API**: 画像処理、ピクセルデータ抽出
*   **Color Analysis**: HSL色空間変換、明度・彩度・色相分析アルゴリズム
*   **AI Image Generation**: Flux 2モデルによる高精度画像編集
*   **Image Processing**: 色ベースセグメンテーション、カスタムマスキング、カラーブレンディング、モルフォロジー処理

## 使い方

### ステップ1: 画像をアップロード
「クリックして画像を選択」エリアをクリックするか、画像をドラッグ＆ドロップしてアップロードします。

### ステップ2: AI解析・診断
自動的にAIモデルによる解析が始まり、以下の情報が表示されます：
- 各パーツの色情報（プレビュー、HEXコード、RGB値）
- **パーソナルカラー診断結果**（春夏秋冬のタイプ）
- あなたに似合うカラーパレットと避けたい色
- 詳細な色分析データ（ベースカラー、明度、彩度、コントラスト）

### ステップ3: AI ヘアカラーシミュレーション
「3パターン生成する」ボタンをクリックすると、AIがあなたのシーズンに最適な3種類のヘアカラーを自動生成します（生成には数十秒かかります）。生成されたサムネイルをクリックすると、メイン画面で拡大表示。Before/Afterボタンで元の髪色と比較できます。

### ステップ4: PDFダウンロード
「診断結果をPDFでダウンロード」ボタンをクリックすると、診断結果とBefore/After画像を含む日本語PDFレポートがダウンロードされます。美容院での相談時に便利です。

## 診断アルゴリズムの仕組み

本ツールのパーソナルカラー診断は、以下の要素を総合的に分析します：

1. **ベースカラー判定**: 肌と唇の色相（Hue）から、ウォームトーン（イエベ）かクールトーン（ブルベ）かを判定
2. **明度分析**: 肌の明るさから、明るいタイプか深いタイプかを判定
3. **彩度分析**: 髪と唇の鮮やかさから、ビビッドタイプかソフトタイプかを判定
4. **コントラスト分析**: 髪と肌の明度差から、高コントラストか低コントラストかを判定

これらの4つの指標をスコアリングし、最も適合するシーズンタイプを判定します。

## 制限事項と注意点

### AI ヘアカラーシミュレーション
- **生成時間**: 1パターンあたり10〜30秒程度かかります（合計で1〜2分）
- **品質**: 最新の画像生成AIにより、従来のピクセル編集よりも自然で高品質な結果が得られます
- **制限事項**: 以下の場合は生成精度が低下する可能性があります
  - 帽子を被っている場合
  - 複雑なヘアスタイル（編み込み、アップスタイルなど）
  - 極端なライティング条件
  - 顔が正面を向いていない場合

### 診断精度
写真の照明条件、メイクの有無、髪染めなどにより、診断結果が変わる場合があります。より正確な診断には以下を推奨します：
- 自然光の下で撮影
- メイク前（またはナチュラルメイク）
- 正面を向いた顔写真
- 髪染め前の地毛の状態

### ブラウザ対応
WebGLおよびWebAssemblyをサポートする最新のブラウザ（Chrome, Edge, Firefox, Safariなど）で動作します。

## ローカル開発

このプロジェクトは静的なWebサイトです。ローカルで動作確認する場合は、以下の手順に従ってください。

1.  リポジトリをクローンまたはダウンロードします。
2.  簡易的なローカルサーバーを立ち上げます（CORS制約を回避するため、`file://` プロトコルではAIモデルが正しくロードされない場合があります）。

```bash
# Pythonを使用する場合
python3 -m http.server 8000

# Node.js (http-server) を使用する場合
npx http-server .
```

3.  ブラウザで `http://localhost:8000` にアクセスします。

## プロジェクト構成

```
/
├── index.html                # メインHTMLファイル
├── js/
│   ├── script.js            # 顔検出・色抽出のメインロジック
│   ├── color-diagnosis.js   # パーソナルカラー診断アルゴリズム
│   ├── ai-hair-color.js     # AI画像生成ヘアカラーシミュレーション
│   ├── hair-simulation.js   # 従来型ヘアカラーシミュレーション
│   └── hair-segmentation.js # 高精度髪領域セグメンテーション
└── README.md                # ドキュメント
```

## 実装済み機能

- [x] AI顔検出と色抽出
- [x] パーソナルカラー診断（春夏秋冬）
- [x] カラーパレット提案
- [x] **AI画像生成ヘアカラーシミュレーション（3パターン自動生成）**
- [x] **Before/After比較表示**
- [x] **プログレスバー付き生成状況表示**

## 今後の拡張予定

- [ ] PDFエクスポート機能の復活（3パターン画像付き）
- [ ] 複数人の顔を同時に診断する機能
- [ ] メイクカラーシミュレーション（リップ、チーク、アイシャドウ）
- [ ] より詳細なカラーコーディネート提案
- [ ] 季節ごとのファッション提案
- [ ] SNSシェア機能
- [ ] AI生成画像の保存機能

## ライセンス

MIT License
